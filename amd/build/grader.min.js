'use strict';var _extends=Object.assign||function(a){for(var c,b=1;b<arguments.length;b++)for(var d in c=arguments[b],c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d]);return a};define(['local_customgrader/vendor-vue','local_customgrader/vendor-vue-router','local_customgrader/vendor-vuex','local_customgrader/vendor-vue-resource','local_customgrader/vendor-vue-js-modal','local_customgrader/vendor-vue-flex','local_customgrader/vendor-vue-toasted','local_customgrader/vendor-loading-indicator','local_customgrader/vendor-lodash','local_customgrader/grader-store','local_customgrader/grader-enums','local_customgrader/grader-utils','local_customgrader/grader-component-main','local_customgrader/grader-router','local_customgrader/grader-filters','local_customgrader/grader-constants'],function(a,b,c,d,e,f,g,h,j,k,l,m,n,o,p,q){a.use(b),a.use(c),a.use(d),a.use(e.default,{dialog:!0}),a.use(f),a.use(g.default,{iconPack:'custom-class'});var r={UPDATE_CATEGORY_OK:'updateCategoryOK',ADD_ELEMENT_OK:'addElementOK'},s={EDIT_CATEGORY:'edit-category',EDIT_ITEM:'edit-item',ADD_ELEMENT:'add-element'},R={name:'CATEGOR\xCDA',id:0},S={name:'\xCDTEM',id:1},T={name:'PARCIAL',id:2},U=[R,S,T],t=new c.Store(k.store),u=a.component('select-aggregation',{template:'\n            <select \n            v-model="aggregation" \n            @change="changeAggregation($event)" \n            id="aggregation">\n                <option \n                v-for="_aggregation in aggregations"\n                v-bind:selected="_aggregation.id == aggregation"\n                v-bind:value="_aggregation.id"\n                >{{_aggregation.name}}</option>\n            </select>\n        ',props:['initialAggregation'],data:function data(){return{aggregation:l.aggregations.SIMPLE,aggregations:q.aggregations}},created:function created(){this.aggregation=this.initialAggregation?this.initialAggregation:this.aggregation},methods:{changeAggregation:function changeAggregation(V){this.$emit('changeAggregation',V.target.value)}}}),v=a.component('edit-category-form',{template:'    \n                <div class="edit-category-form">\n                    <form>\n                        <h3>Editando Categor\xEDa: {{category.fullname}}</h3>\n                            <label for="categoryFullName">\n                                Nombre de la categoria\n                            </label>\n                            <input :disabled="isCourseCategory" id="categoryFullName" v-model="categoryFullName">\n                            <label for="aggregation">\n                            Tipo de calificaci\xF3n\n                            </label>\n                            <select-aggregation \n                                    v-bind:initialAggregation="category.aggregation"\n                                    v-on:changeAggregation="changeAggregation">\n                            </select-aggregation>\n                            <button type="button" v-on:click="updateCategory">Guardar</button>\n                    </form>\n                </div>\n            ',data:function data(){return{categoryFullName:'',gradeTypeId:0,aggregations:q.aggregations}},computed:_extends({},c.mapState(['selectedCategoryId']),c.mapGetters({category:'selectedCategory'}),{isCourseCategory:function isCourseCategory(){return 1==this.category.depth}}),mounted:function mounted(){this.categoryFullName=this.category.fullname,this.aggregation=this.category.aggregation},methods:{setAggretation:function setAggretation(V){this.aggregation=V},changeAggregation:function changeAggregation(V){this.aggregation=V},updateCategory:function updateCategory(){var V=this;this.$store.dispatch(k.actions.UPDATE_CATEGORY,_extends({},this.category,{fullname:this.categoryFullName,aggregation:this.aggregation,aggregationcoef:50})).then(function(){V.$emit(r.UPDATE_CATEGORY_OK)}).catch(function(){V.$toasted.show('Ha habido un error guardando la categoria',{duration:3e3,theme:'bubble'})})}}}),w=a.component('close-modal-button',{template:'\n        <i class="fa fa-2x fa-times-circle" v-bind:style="closeButtonStyle"  @click="$modal.hide(modalName)"></i>\n        ',props:{modalName:{type:String,required:!0}},data:function data(){return{closeButtonStyle:{position:'absolute',top:'10px',right:'10px'}}}}),x=a.component('modal-add-element',{template:'\n       <modal \n        v-bind:name="modalName"\n        v-bind:transition="\'nice-modal-fade\'"\n        :draggable="true"\n        >\n            <add-element-form v-on:addElementOK="$modal.hide(modalName)"></add-element-form>\n            <close-modal-button v-bind:modalName="modalName"></close-modal-button>\n       </modal>\n       ',data:function data(){return{modalName:s.ADD_ELEMENT}}}),y=a.component('modal-edit-category',{template:'<modal\n                    v-bind:name="modalName" \n                    v-bind:transition="\'nice-modal-fade\'"\n                    :draggable="true"\n                    >\n                        <edit-category-form   v-on:updateCategoryOK="$modal.hide(modalName)"></edit-category-form>\n                        <close-modal-button v-bind:modalName="modalName"></close-modal-button>\n                   </modal>\n       ',data:function data(){return{modalName:s.EDIT_CATEGORY}}}),z=a.component('add-element-form',{template:'\n        <div class="add-element-form">\n           <form>\n           <h2>A\xF1adir elemento</h2>\n           <label></label>\n           <select id="elementType" v-model="elementTypeId">\n               <option v-for="elementType in elementTypes" v-bind:value="elementType.id">\n                {{elementType.name}}\n               </option>\n           </select>\n           <label for="elementName">\n            Nombre de el elemento\n            </label>\n            <input id="elementName" v-model="elementName">\n            <template v-if="parentCategory.aggregation == weigthedMeanOfGrades">\n                <label for="elementAggregationCoef">\n                    Peso \n                </label>\n                        <input \n            placeholder="Ingrese un valor entre 1 y 100" \n            id="elementAggregationCoef" \n            v-model="elementAggregationCoef" type="number">\n            </template>\n            <template v-if="elementTypeId === categoryElementTypeId || elementTypeId === partialExamElementId">\n                <label >\n                    Tipo de agregaci\xF3n\n                </label>\n                <select-aggregation\n                    v-bind:changeAggregation="changeAggregation"\n                />\n            </template>\n           <button type="button" v-on:click="createElement()">A\xF1adir</button>\n           </form>\n       </div>\n       ',data:function data(){return{elementTypes:U,categoryElementTypeId:R.id,partialExamElementId:T.id,elementTypeId:S.id,elementName:'',aggregation:l.aggregations.SIMPLE,elementAggregationCoef:''}},computed:_extends({},c.mapState(['selectedCategoryId','course']),c.mapGetters(['selectedCategory']),{parentCategory:function parentCategory(){return this.selectedCategory},weigthedMeanOfGrades:function weigthedMeanOfGrades(){return l.aggregations.PROMEDIO}}),methods:{changeAggregation:function changeAggregation(V){this.aggregation=V},extractItem:function extractItem(){return{itemname:this.elementName,aggregationcoef:this.elementAggregationCoef,parent_category:this.parentCategory.id,courseid:this.course.id}},extractPartialExam:function extractPartialExam(){return{itemname:this.elementName,aggregationcoef:this.elementAggregationCoef,parent_category:this.parentCategory.id,courseid:this.course.id,aggregation:this.aggregation}},extractCategory:function extractCategory(){return{fullname:this.elementName,courseid:this.course.id,parent_category:this.parentCategory.id,aggregation:this.aggregation}},createItem:function createItem(){var W=this,V=this.extractItem();this.$store.dispatch(k.actions.ADD_ITEM,V).then(function(){W.$emit(r.ADD_ELEMENT_OK),W.$toasted.show('Se ha a\xF1adido el item \''+V.itemname+'\'',{duration:3e3,icon:'fa fa-check'})}).catch(function(){W.$toasted.show('Ha ocurrido un error guardando el nuevo item.',{duration:3e3,theme:'bubble'})})},createCoursePartialExam:function createCoursePartialExam(){var W=this,V=this.extractPartialExam();this.$store.dispatch(k.actions.ADD_PARTIAL_EXAM,V).then(function(){W.$emit(r.ADD_ELEMENT_OK),W.$toasted.show('Se ha a\xF1adido el parcial \''+V.itemname+'\'',{duration:3e3,icon:'fa fa-check'})}).catch(function(){W.$toasted.show('Ha ocurrido un error guardando el nuevo parcial.',{duration:3e3,theme:'bubble'})})},createCategory:function createCategory(){var X=this,V=this.extractCategory(),W={category:V,weight:this.elementAggregationCoef};this.$store.dispatch(k.actions.ADD_CATEGORY,W).then(function(){X.$emit(r.ADD_ELEMENT_OK),X.$toasted.show('Se ha a\xF1adido la categoria \''+V.fullname+'\'',{duration:3e3,icon:'fa fa-check'})}).catch(function(){X.$toasted.show('Ha ocurrido un error guardando la nueva categoria.',{duration:3e3,theme:'bubble'})})},createElement:function createElement(){this.elementTypeId===S.id?this.createItem():this.elementTypeId===R.id?this.createCategory():this.elementTypeId===T.id&&this.createCoursePartialExam()}}}),A=a.component('item-mini-menu',{template:'\n                <div>\n                    <i class="fa fa-trash" v-on:click="deleteItem()"></i>\n                </div>\n            ',props:['itemId'],methods:{deleteItem:function deleteItem(){h.show(),this.$store.dispatch(k.actions.DELETE_ITEM,this.itemId).then(function(){return h.hide()})}}}),B=a.component('category-mini-menu',{template:'\n                <div class ="category-mini-menu" v-bind:style="style">\n                    <i class="fa fa-edit" v-on:click="showEditDialog"></i>\n                    <i class="fa fa-plus" v-on:click="showAddElementDialog"></i>\n                    <i class="fa fa-trash" v-show="showDelete" v-on:click="showDeleteElementDialog"></i>\n                </div>\n            ',props:{categoryId:[Number,String],showDelete:{type:Boolean,required:!1,default:!0},allowEditName:{type:Boolean,required:!1,default:!0}},data:function data(){return{style:{display:'grid',gridTemplateColumns:'repeat(3, max-content)',gridColumnGap:'8px'}}},computed:_extends({},c.mapGetters(['categoryById']),{category:function category(){return this.categoryById(this.categoryId)}}),methods:{deleteCategory:function deleteCategory(){var V=this;return this.$store.dispatch(k.actions.DELETE_CATEGORY,this.categoryId).then(function(){V.$toasted.show('Se ha borrado la categoria',{duration:3e3})}).catch(function(){V.$toasted.show('Ha habido un error al borrar la categoria, no se ha borrado',{duration:3e3,theme:'bubble'})})},showDeleteElementDialog:function showDeleteElementDialog(){var V=this;this.$modal.show('dialog',{title:'Eliminaci\xF3n de categoria',text:'Estas a punto de eliminar una categoria',buttons:[{title:'Borrar',handler:function handler(){V.deleteCategory().finally(function(){return V.$modal.hide('dialog')})}},{title:'Cancelar'}]})},showEditDialog:function showEditDialog(){this.$store.commit(k.mutations.SET_SELECTED_CATEGORY_ID,this.category.id),this.$modal.show(s.EDIT_CATEGORY)},showAddElementDialog:function showAddElementDialog(){this.$store.commit(k.mutations.SET_SELECTED_CATEGORY_ID,this.category.id),this.$modal.show(s.ADD_ELEMENT)}}}),C=a.component('th-course',{template:'\n            <th \n            v-bind:colspan="colspan"\n            @mouseover="showMenu = true"\n            @mouseout="showMenu = false"\n            >\n           \n                <flex-row align-v="center" v-bind:style="editZoneStyles" >\n                    <span class="gradeitemheader">        \n                    {{course.fullname}}       \n                    </span>\n                    <category-mini-menu v-bind:showDelete="false" v-bind:categoryId="category.id"  v-show="showMenu"></category-mini-menu>\n                </flex-row> \n                </th>\n            </th>\n       ',props:['colspan'],data:function data(){return{showMenu:!1,editZoneStyles:{display:'grid',gridTemplateColumns:'repeat(2, max-content)',gridColumnGap:'5px'}}},computed:_extends({},c.mapState(['course']),c.mapGetters(['courseLevel','categoryById']),{courseCategoryId:function courseCategoryId(){return this.courseLevel.object.id},category:function category(){return this.categoryById(this.courseCategoryId)}})}),D=a.component('course-mini-menu',{template:'\n                <div v-bind:style="style">\n                    <i class="fa fa-plus" v-on:click="showAddElementDialog"></i>\n                </div>\n            ',props:['categoryId'],data:function data(){return{style:{display:'grid',gridTemplateColumns:'repeat(3, max-content)',gridColumnGap:'8px'}}},computed:_extends({},c.mapGetters(['categoryById']),{category:function category(){return this.categoryById(this.categoryId)}}),methods:{showAddElementDialog:function showAddElementDialog(){this.$store.commit(k.mutations.SET_SELECTED_CATEGORY_ID,this.category.id),this.$modal.show(s.ADD_ELEMENT)}}}),E=a.component('th-category',{template:'    \n            <th\n            class="th-category"\n            @mouseover="showMenu = true"\n            @mouseout="showMenu = false" \n            v-bind:colspan="childSize" >\n                <flex-row align-v="center"  v-bind:style="editZoneStyles">\n                   \n                    <editable :content="category.fullname" @update="updateCategoryName"></editable>\n                    <editable \n                    :sufix="\'%\'" \n                    @update="saveAggregationCoef($event)"\n                    :content="aggregationCoef | round(2)" \n                    v-if="parentCategory.aggregation == weightedAggregation"\n                    ></editable>\n                    <category-mini-menu v-bind:categoryId="category.id" v-show="true"></category-mini-menu>\n                </flex-row>\n            </th>\n       ',props:['element'],data:function data(){return{categoryName:'',editZoneStyles:{display:'grid',gridTemplateColumns:'repeat(3, max-content)',gridColumnGap:'5px'},showMenu:!1}},computed:_extends({},c.mapGetters(['categoryById','categoryChildSize']),c.mapState(['items']),{category:function category(){return this.categoryById(this.element.object.id)},childSize:function childSize(){return this.categoryChildSize(this.category.id)},categoryGradeItem:function categoryGradeItem(){return this.items[this.category.grade_item]},aggregationCoef:function aggregationCoef(){return this.categoryGradeItem.aggregationcoef},parentCategory:function parentCategory(){return this.categoryById(this.category.parent)},weightedAggregation:function weightedAggregation(){return l.aggregations.PROMEDIO}}),mounted:function mounted(){this.categoryName=this.category.fullname},methods:{updateCategoryName:function updateCategoryName(V){this.$store.dispatch(k.actions.UPDATE_CATEGORY,_extends({},this.category,{fullname:V}))},saveAggregationCoef:function saveAggregationCoef(V){V!==this.aggregationCoef&&this.$store.dispatch(k.actions.UPDATE_ITEM,_extends({},this.categoryGradeItem,{aggregationcoef:V}))}}}),F=a.component('item-actions-mini',{template:'\n        \n        ',props:['itemId']}),G=a.component('th-student-names',{template:'\n       <th class="th-student-names"> \n           <flex-row>\n               <a v-on:click="changeOrderToLastame()">Apellidos</a> \n               <span>/ </span>\n               <a v-on:click="changeOrderToName">Nombres</a>\n           </flex-row> \n       </th>\n       ',data:function data(){return{lastNameDirectionAsc:!0,firstNameDirectionAsc:!0}},methods:{changeOrderToLastame:function changeOrderToLastame(){this.$store.commit(k.mutations.SET_STUDENT_SORT_METHOD,{name:l.sortStudentMethods.LAST_NAME,order:this.lastNameDirectionAsc?l.sortDirection.ASC:'desc'}),this.lastNameDirectionAsc=!this.lastNameDirectionAsc},changeOrderToName:function changeOrderToName(){this.$store.commit(k.mutations.SET_STUDENT_SORT_METHOD,{name:l.sortStudentMethods.FIRST_NAME,order:this.firstNameDirectionAsc?l.sortDirection.ASC:'desc'}),this.firstNameDirectionAsc=!this.firstNameDirectionAsc}}}),H=a.component('tr-items',{template:'\n                    <tr class="tr-items">\n                    <th-student-names></th-student-names>\n                    <th colspan="1" v-for="additionalColumnAtFirst in additionalColumnsAtFirst" v-show="!additionalColumnAtFirst.hide">{{additionalColumnAtFirst.text}}</th>\n                    <template v-for="(itemId, index) in orderedItemIds">       \n                        <th-item-category \n                        v-if="items[itemId].itemtype === \'category\'" \n                        v-bind:itemId="items[itemId].id" \n                        v-bind:colspan="1"\n                        ></th-item-category> \n                        \n                        <th-item-manual-and-mod \n                        v-if="items[itemId].itemtype === \'manual\' || items[itemId].itemtype === \'mod\'"  \n                        v-bind:itemId="items[itemId].id" \n                        ></th-item-manual-and-mod>\n                     </template>\n                     <th colspan="1" v-for="additionalColumnAtEnd in additionalColumnsAtEnd">{{additionalColumnAtEnd.text}}</th>\n                     </tr>\n   ',computed:_extends({},c.mapGetters({orderedItemIds:'itemOrderIds'}),c.mapState(['additionalColumnsAtFirst','additionalColumnsAtEnd','items']))});a.component('editable',{template:'<div contenteditable="true" @blur="update">{{content}}<span>{{sufix}}</span></div>',props:['content','sufix'],methods:{getContent:function getContent(V){return V.target.innerText.replace(this.sufix,'')},update:function update(V){this.$emit('update',this.getContent(V))}}});var I=a.component('th-item-manual-and-mod',{template:'         \n                <th class="th-item-manual-and-mod"\n                v-cloak\n                 @mouseover="showMenuItems = true"\n                 @mouseout="showMenuItems = false"\n                ><!--v-on:click="deleteItem(item.id)"-->\n                <flex-row v-bind:style="editZoneStyles" align-v="center">\n                    <editable :content="item.itemname" @update="saveNameChanges($event)"></editable>\n                    <editable\n                     :sufix="\'%\'"\n                     :content="item.aggregationcoef | round(2)" \n                     @update="saveAggregationCoefChanges($event)" \n                     v-if="parentCategory.aggregation == weightedAggregation"\n                     ></editable>\n                    <item-mini-menu v-show="showMenuItems" v-bind:itemId="item.id"></item-mini-menu>\n                </flex-row>\n                </th>\n   ',data:function data(){return{showMenuItems:!1,editZoneStyles:{display:'grid',gridTemplateColumns:'repeat(3, max-content)',gridColumnGap:'5px'}}},props:['itemId'],methods:_extends({},c.mapActions({deleteItem:k.actions.DELETE_ITEM}),{saveNameChanges:function saveNameChanges(V){V!==this.item.itemname&&this.$store.dispatch(k.actions.UPDATE_ITEM,_extends({},this.item,{itemname:V}))},saveAggregationCoefChanges:function saveAggregationCoefChanges(V){V!==this.item.aggregationcoef&&this.$store.dispatch(k.actions.UPDATE_ITEM,_extends({},this.item,{aggregationcoef:V}))}}),computed:_extends({},c.mapState(['items']),c.mapGetters(['categoryById']),{item:function item(){return this.items[this.itemId]},parentCategory:function parentCategory(){return this.categoryById(this.item.categoryid)},weightedAggregation:function weightedAggregation(){return l.aggregations.PROMEDIO}})}),J=a.component('th-item-category',{template:'         \n                <th class="th-item-category"v-bind:colspan="colspan" >\n                            {{itemName}}\n                </th>\n   ',props:['itemId','colspan'],computed:_extends({},c.mapState(['items']),c.mapGetters(['categoryById']),{item:function item(){return this.items[this.itemId]},categoryParent:function categoryParent(){return this.categoryById(this.item.iteminstance)},itemName:function itemName(){return'TOTAL '+this.categoryParent.fullname}})}),K=a.component('th-student',{template:'\n                <th class="th-student"scope="row">\n                    {{studentFullName}}\n                </th>\n                ',props:['studentId'],computed:_extends({},c.mapGetters(['studentById']),c.mapGetters({students:'studentSet'}),{student:function student(){return this.studentById(this.studentId)},studentFullName:function studentFullName(){return this.student.lastname+' '+this.student.firstname}})}),L=a.component('td-grade',{template:'\n                <td  class="td-grade"> \n                <input \n                class="grade-input"\n                v-bind:disabled="inputDisabled" \n                type="number" \n                v-bind:tabindex="tabIndex" \n                v-bind:step="step"  \n                v-bind:max="grade.rawgrademax" \n                v-bind:min="grade.rawgrademin" \n                v-bind:size="decimalPlaces + 1"\n                v-model.lazy="finalGrade">\n                </td>\n                ',props:['gradeId','studentIndex','itemIndex'],methods:_extends({},c.mapActions({updateGrade:k.actions.UPDATE_GRADE})),computed:_extends({},c.mapState(['grades','items','course','decimalPlaces']),{step:function step(){return Math.pow(10,-this.decimalPlaces)}},c.mapGetters(['studentsCount']),{tabIndex:function tabIndex(){return(this.itemIndex+1)*this.studentsCount+this.studentIndex+1},inputDisabled:function inputDisabled(){return'category'===this.item.itemtype||'course'===this.item.itemtype},grade:function grade(){return this.grades[this.gradeId]},item:function item(){return this.items[this.grade.itemid]},finalGrade:{get:function get(){return m.round(this.grade.finalgrade,this.decimalPlaces)},set:function set(V){this.grade.finalgrade=V,this.updateGrade(this.grade,this.course.id)}}})}),M=a.component('tr-grades',{template:'\n                <tr \n                v-bind:class="{is_ases: student.is_ases}" \n                v-bind:title="student.is_ases? \'El estudiante pertenece al programa ASES\' : \'\'"\n                >\n                    <th-student v-bind:studentId="student.id"></th-student>\n                    <td >{{student.username}}</td>\n                    <td-grade \n                    v-for="(gradeId, index) in studentGradeIdsOrdered" \n                    :key="gradeId"\n                    v-bind:studentIndex="studentIndex"\n                    v-bind:itemIndex="index"\n                    v-bind:gradeId="gradeId"\n                    >\n                    </td-grade>\n                   \n                </tr>\n                ',props:['studentId','studentIndex'],computed:_extends({},c.mapState(['students','grades']),c.mapGetters(['itemOrderIds']),{student:function student(){return this.students[this.studentId]},studentGradeIdsOrdered:function studentGradeIdsOrdered(){return m.orderGradeIdsInItemSetOrder(this.student.gradeIds,this.grades,this.itemOrderIds)}})}),N=a.component(n.name,n.component),O=a.component('home',{template:'<div>hola</div>',computed:{username:function username(){return this.$route.params.username}},methods:{goBack:function goBack(){1<window.history.length?this.$router.go(-1):this.$router.push('/')}}});a.filter(p.round.name,p.round.func);var P=new b({routes:o.routes}),Q=new a({store:t,router:P,components:{ThCourse:C,Grader:N,EditCategoryForm:v,Home:O,ThCategory:E,TrItems:H,ThItemManualAndMod:I}});return{init:function init(){Q.$mount('#app'),$(document).ready(function(){})}}});